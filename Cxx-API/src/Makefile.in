#
# Copyright (C) 2004 Stefan Seefeld
# All rights reserved.
# Licensed to the public under the terms of the GNU LGPL (>= 2),
# see the file COPYING for details.
#

SHELL	:= /bin/sh

top_srcdir:= @top_srcdir@
srcdir	:= @srcdir@
synopsis:= python synopsis.py

PYTHON	:= @PYTHON@

CC	:= @CC@
CXX	:= @CXX@
MAKEDEP	:= $(CXX) -M
CPPFLAGS:= @CPPFLAGS@ -I $(top_srcdir)/include -I @PYTHON_INCLUDE@
CFLAGS	:= @CFLAGS@
CXXFLAGS:= @CXXFLAGS@
LDFLAGS	:= @LDFLAGS@
LIBS	:= @LIBS@ -lpthread

HDR	:= $(shell find $(top_srcdir)/include -name '*.hh' -print)
SRC	:= Path.cc
OBJ	:= $(patsubst %.cc, %.o, $(SRC))

TARGET	:= ../lib/libSynopsis.a

vpath %.cc $(srcdir)

all: $(TARGET)

doc: cxx-api.syn cxx-api-impl.syn

# Link C++ files together
cxx-api.syn: $(HDR_SYN)
	@echo linking C++ headers together
	$(synopsis) link_cxx --output=$@ $^

cxx-api-impl.syn: $(HDR_SYN) $(CC_SYN)
	@echo linking all C++ files together
	$(synopsis) link_cxx --output=$@ $^

%.o : %.cc
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

# Compile C++ .hh files
$(HDR_SYN): %.syn: %
	@echo parsing $^
	mkdir -p $(dir $@)
	$(synopsis) cxx --output=$@ $?

# Compile C++ .cc files
$(CC_SYN): %.cc.syn: %.cc
	@echo parsing $^
	mkdir -p $(dir $@)
	$(synopsis) cxx --output=$@ $?

$(TARGET): $(OBJ)
	ar rcs $@ $(OBJ)

clean :
	rm -f *~ *.o $(TARGET)
