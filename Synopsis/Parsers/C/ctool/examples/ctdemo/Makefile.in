# $Id: Makefile.in,v 1.2 2003/08/19 05:23:27 stefan Exp $
#
# This source file is a part of the ctool Project.
# Copyright (C) 2003 Stefan Seefeld
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Library General Public License for more details.
#
# You should have received a copy of the GNU Library General Public
# License along with this library; if not, write to the
# Free Software Foundation, Inc., 675 Mass Ave, Cambridge,
# MA 02139, USA.

SHELL		:= /bin/sh

srcdir	:= @srcdir@

include ../../local.mk

CPP_PATH:=/usr/bin/cpp

CTOOLFLAGS:= -D USE_GCC_4_CPP -D DEBUG

CPPFLAGS+= -D LIB_CPP=\"$(CPP_PATH)\" $(CTOOLFLAGS)
CXXFLAGS+= -g -Wall

SRC	:= ctdemo.cpp
OBJ	:= $(patsubst %.cpp, %.o, $(SRC))
DEP	:= $(patsubst %.cpp, %.d, $(SRC))

TARGET	:= ../../bin/ctdemo

vpath %.h  $(top_abs_builddir)/include $(top_abs_srcdir)/include
vpath %.cpp  $(srcdir)

.FORCE:
.PHONY: depend install clean distclean maintainer-clean dist

all: $(TARGET)

$(TARGET): $(OBJ)
	@echo creating $(@F)
	$(CXX) $(LDFLAGS) -L $(abs_top_builddir)/lib -o $@ $(OBJ) -lctool $(LIBS)

depend:	$(DEP)

install: all

uninstall:

clean:
	rm -rf $(TARGET)
	rm $(OBJ) $(DEP)

distclean:	clean
	rm -f Makefile

maintainer-clean: distclean

%.o:	%.cpp
	@echo compiling $(@F)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

%.d:	%.cpp %.h
	@echo generating dependencies for $(<F)
	$(SHELL) -ec '$(MAKEDEP) $(CPPFLAGS) $< | sed "s/$*\\.o[ :]*/$*\\.d $*\\.o : /g" > $@'

ifneq (,$(findstring depend, $(MAKECMDGOALS)))
$(DEP): %.d:	.FORCE
endif

ifeq (,$(filter $(MAKECMDGOALS), depend doc clean distclean maintainer-clean))
-include $(DEP)
endif
