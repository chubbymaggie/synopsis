# $Id: Makefile.in,v 1.13 2004/01/12 01:00:57 stefan Exp $
#
# Copyright (C) 2003 Stefan Seefeld
# All rights reserved.
# Licensed to the public under the terms of the GNU LGPL (>= 2),
# see the file COPYING for details.
#

SHELL	:= /bin/sh

srcdir	:= @srcdir@

PYTHON	:= @PYTHON@

CC	:= @CC@
CXX	:= @CXX@
MAKEDEP	:= $(CXX) -M
CPPFLAGS:= @CPPFLAGS@ -I $(srcdir) -I $(srcdir)/../../../include -I @PYTHON_INCLUDE@
CFLAGS	:= @CFLAGS@
CXXFLAGS:= @CXXFLAGS@
LDFLAGS	:= @LDFLAGS@
LIBS	:= @LIBS@ -lpthread
LIBRARY_EXT := @LIBEXT@

UCPP_FLAGS:= -DSYNOPSIS -DSTAND_ALONE -DAUDIT -DMEM_CHECK

UCPP_SO	:= ucpp$(LIBRARY_EXT)

UCPP_FILES	:= mem hashtable cpp lexer assert macro eval

SRC		:= $(patsubst %, ucpp/%.c, $(UCPP_FILES))
SRC		+= cpp.cc
OBJ		:= $(patsubst %, %.o, $(basename $(SRC)))

TARGET		:= $(UCPP_SO)

vpath %.cc $(srcdir)
vpath %.c $(srcdir)
vpath %.h $(srcdir)

all: $(TARGET)

%.o : %.cc
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

%.o : %.c
	$(CC) $(CPPFLAGS) $(CFLAGS) $(UCPP_FLAGS) -c -o $@ $<

ucpp:		$(AOBJ)
	$(CC) -o $@ $^

$(UCPP_SO): $(OBJ)
	$(CXX) -shared $(LDFLAGS) -o $@ $^ $(LIBS)

clean :
	rm -f *~ ucpp/*.o ucpp/*.go ucpp/*.a ucpp/*.ga \
        $(UCPP_SO) ucpp/*.ao occ/*.o occ/*.go *.pyc *.pyo .deps.* base_lib
